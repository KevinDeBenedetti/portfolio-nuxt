name: CD

on:
  push:
    branches:
      - main
      - dev
  workflow_dispatch:

permissions:
  contents: write
  packages: write
  issues: write
  pull-requests: write
  actions: read
  security-events: write

jobs:
  # deploy:
  #   name: Deploy to Dokploy
  #   uses: ./.github/workflows/deploy.yml
  #   secrets:
  #     DOKPLOY_API_TOKEN: ${{ secrets.DOKPLOY_API_TOKEN }}
  #     DOKPLOY_COMPOSE_ID_PROD: ${{ secrets.DOKPLOY_COMPOSE_ID_PROD }}
  #     DOKPLOY_COMPOSE_ID_DEV: ${{ secrets.DOKPLOY_COMPOSE_ID_DEV }}

  security-scan:
    name: Security Scan
    needs: deploy
    if: always() && needs.deploy.result == 'success'
    uses: ./.github/workflows/security-scan.yml
    with:
      target_url: ${{ github.ref_name == 'main' && 'https://kevindb.dev' || 'https://REDACTED_URL' }}
      scan_type: baseline
