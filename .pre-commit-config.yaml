# Pre-commit configuration for prek
# Documentation: https://prek.j178.dev/
# Hooks reference: https://pre-commit.com/hooks.html

default_stages: [pre-commit]
fail_fast: false

repos:
  # Built-in hooks for common checks
  - repo: builtin
    hooks:
      - id: check-added-large-files
        args: [--maxkb=500]
        name: ğŸ” Check for large files

      - id: check-case-conflict
        name: ğŸ” Check for case conflicts

      - id: check-merge-conflict
        name: ğŸ” Check for merge conflicts

      - id: check-toml
        name: ğŸ” Check TOML syntax

      - id: check-yaml
        name: ğŸ” Check YAML syntax

      - id: check-json
        name: ğŸ” Check JSON syntax
        exclude: ^(.oxlintrc\.json|.oxfmtrc\.json|tsconfig\.json)$

      - id: end-of-file-fixer
        name: ğŸ“ Fix end of files

      - id: trailing-whitespace
        name: ğŸ“ Trim trailing whitespace

  # Local hooks for your project-specific commands
  - repo: local
    hooks:
      - id: check-all
        name: ğŸš€ Lint + Format + Typecheck (turbo cached)
        entry: bun run check
        language: system
        always_run: true
        pass_filenames: false
        priority: 0

  # Pre-push hooks (more thorough checks)
  - repo: local
    hooks:
      - id: full-check
        name: ğŸ” Full check (lint:type)
        entry: bun turbo run lint:type
        language: system
        stages: [pre-push]
        always_run: true
        pass_filenames: false

  # Commit message validation
  - repo: local
    hooks:
      - id: commit-msg-format
        name: ğŸ“ Validate commit message format
        entry: bash
        args:
          - -c
          - |
            msg=$(cat "$@")
            if echo "$msg" | grep -qE "^(Merge|Revert)"; then
              exit 0
            fi
            if ! echo "$msg" | grep -qE "^(feat|fix|docs|style|refactor|perf|test|build|ci|chore|revert)(\(.+\))?: .{3,}"; then
              echo "âŒ Format de commit invalide!"
              echo "Utilisez: type(scope): description"
              echo "Types: feat, fix, docs, style, refactor, perf, test, build, ci, chore"
              exit 1
            fi
          - --
        language: system
        stages: [commit-msg]
        always_run: true
